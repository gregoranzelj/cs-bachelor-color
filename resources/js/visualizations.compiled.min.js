(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(l){var o=b[m][1][l];return c(o?o:l)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(c,f,b){Object.defineProperty(b,"__esModule",{value:true});var d=function(){function h(m,k){for(var j=0;j<k.length;j++){var l=k[j];l.enumerable=l.enumerable||false;l.configurable=true;if("value" in l){l.writable=true}Object.defineProperty(m,l.key,l)}}return function(k,i,j){if(i){h(k.prototype,i)}if(j){h(k,j)}return k}}();function g(h,i){if(!(h instanceof i)){throw new TypeError("Cannot call a class as a function")}}var a=b.ColorSystemProperty=function(){function h(n,m,j,l,k){g(this,h);this.value=n;this.name=l;this.short_name=k;this.min=m;this.max=j}d(h,[{key:"set_value",value:function i(j){this.value=j}}]);return h}()},{}],2:[function(f,c,h){Object.defineProperty(h,"__esModule",{value:true});h.RGBCubeVisualization=undefined;var g=function(){function o(s,q){for(var p=0;p<q.length;p++){var r=q[p];r.enumerable=r.enumerable||false;r.configurable=true;if("value" in r){r.writable=true}Object.defineProperty(s,r.key,r)}}return function(r,p,q){if(p){o(r.prototype,p)}if(q){o(r,q)}return r}}();var k=function d(p,s,r){if(p===null){p=Function.prototype}var t=Object.getOwnPropertyDescriptor(p,s);if(t===undefined){var q=Object.getPrototypeOf(p);if(q===null){return undefined}else{return d(q,s,r)}}else{if("value" in t){return t.value}else{var o=t.get;if(o===undefined){return undefined}return o.call(r)}}};var l=f("./Visualization");var i=f("./ColorSystemProperty");var b=f("./VisualizationControlSlider");function j(o,p){if(!(o instanceof p)){throw new TypeError("Cannot call a class as a function")}}function m(o,p){if(!o){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return p&&(typeof p==="object"||typeof p==="function")?p:o}function n(p,o){if(typeof o!=="function"&&o!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof o)}p.prototype=Object.create(o&&o.prototype,{constructor:{value:p,enumerable:false,writable:true,configurable:true}});if(o){Object.setPrototypeOf?Object.setPrototypeOf(p,o):p.__proto__=o}}var a=h.RGBCubeVisualization=function(r){n(q,r);function q(s){j(this,q);var t=m(this,(q.__proto__||Object.getPrototypeOf(q)).call(this,s));t.wireframe_cube_geometry=new THREE.BoxGeometry(1,1,1);t.wireframe_cube=new THREE.BoxHelper(new THREE.Mesh(t.wireframe_cube_geometry),0);t.wireframe_cube.applyMatrix(new THREE.Matrix4().makeTranslation(0.5,0.5,0.5));t.scene.add(t.wireframe_cube);t.rgb_cube_geometry=new THREE.BoxGeometry(1,1,1);t.rgb_cube_shader=f("../shaders/rgb-fragment.glsl");t.rgb_cube_mat=new THREE.ShaderMaterial({vertexShader:(0,l.DEFAULT_VERTEX_SHADER)(),fragmentShader:t.rgb_cube_shader()});t.rgb_cube_mesh=new THREE.Mesh(t.rgb_cube_geometry,t.rgb_cube_mat);t.rgb_cube_mesh.applyMatrix(new THREE.Matrix4().makeTranslation(0.5,0.5,0.5));t.scene.add(t.rgb_cube_mesh);t.pivot.applyMatrix(new THREE.Matrix4().makeTranslation(0.5,0.5,0.5));t.red_property=new i.ColorSystemProperty(1,0,1,"R","r");t.green_property=new i.ColorSystemProperty(1,0,1,"G","g");t.blue_property=new i.ColorSystemProperty(1,0,1,"B","b");t.red_control=null;t.green_control=null;t.blue_control=null;if(t.$figure!=null){t.init_controls();t.init_advanced_controls()}return t}g(q,[{key:"init_controls",value:function o(){k(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),"init_controls",this).call(this);var s=this.$figure.find(".visualization-controls");if(s.length==0){return}this.red_control=new b.VisualizationControlSlider(this.$figure.find(".visualization-controls"),this.red_property,0.001);this.green_control=new b.VisualizationControlSlider(this.$figure.find(".visualization-controls"),this.green_property,0.001);this.blue_control=new b.VisualizationControlSlider(this.$figure.find(".visualization-controls"),this.blue_property,0.001)}},{key:"init_advanced_controls",value:function p(){k(q.prototype.__proto__||Object.getPrototypeOf(q.prototype),"init_advanced_controls",this).call(this);var s=this.$figure.find(".visualization-controls-advanced");if(s.length==0){return}}}]);return q}(l.Visualization)},{"../shaders/rgb-fragment.glsl":7,"./ColorSystemProperty":1,"./Visualization":3,"./VisualizationControlSlider":4}],3:[function(b,d,a){Object.defineProperty(a,"__esModule",{value:true});var c=function(){function i(m,k){for(var j=0;j<k.length;j++){var l=k[j];l.enumerable=l.enumerable||false;l.configurable=true;if("value" in l){l.writable=true}Object.defineProperty(m,l.key,l)}}return function(l,j,k){if(j){i(l.prototype,j)}if(k){i(l,k)}return l}}();function g(i,j){if(!(i instanceof j)){throw new TypeError("Cannot call a class as a function")}}var f=a.DEFAULT_VERTEX_SHADER=b("../shaders/default-vertex.glsl");var h=a.Visualization=function(){function r(y){g(this,r);var x=this;this.$container=y;this.$figure=y.parent().hasClass("figure")?y.parent():null;this.fov=45;this.min_focal_length=10;this.max_focal_length=400;this.zoom_steps=20;this.zoom_sensitivity=0.25;this.aspect=3/2;this.$container.height(this.$container.width()/this.aspect);this.near=0.1;this.far=10000;this.renderer=new THREE.WebGLRenderer({antialias:true});this.scene=new THREE.Scene();this.pivot=new THREE.Object3D();this.camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far);this.camera.position.set(0,0,0,1);this.camera.applyMatrix(new THREE.Matrix4().makeTranslation(0,0,3));this.camera.lookAt(this.scene.position);this.pivot.add(this.camera);this.scene.add(this.pivot);this.renderer.setClearColor(5263440,1);this.renderer.setSize(this.$container.width(),this.$container.height());this.$container.append(this.renderer.domElement);$(window).resize(function(){return x.on_resize.call(x)});this.current_rotation=new THREE.Euler(0,0,0,"YXZ");this.starting_rotation=new THREE.Euler(0,0,0,"YXZ");this.starting_focal_length=0;this.dragging=false;this.two_fingers_touching=false;this.drag_start=new THREE.Vector2(0,0);this.scale_start_distance=0;this.$container.on("mousedown",function(z){return x.on_mouse_down.call(x,z)});this.$container.on("wheel",function(z){return x.on_wheel.call(x,z)});this.mouse_move_handler=function(z){return x.on_mouse_move.call(x,z)};this.mouse_up_handler=function(z){return x.on_mouse_up.call(x,z)};this.$container.on("touchstart",function(z){return x.on_touch_start.call(x,z)});this.$container.on("touchmove",function(z){return x.on_touch_move.call(x,z)});this.$container.on("touchcancel",function(z){return x.on_touch_cancel.call(x,z)});this.$container.on("touchend",function(z){return x.on_touch_end.call(x,z)})}c(r,[{key:"render",value:function j(){this.renderer.render(this.scene,this.camera)}},{key:"init_controls",value:function i(){}},{key:"init_advanced_controls",value:function l(){}},{key:"update_rotation",value:function u(y,x){this.current_rotation.y=(this.starting_rotation.y+x)%(2*Math.PI);this.current_rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,(this.starting_rotation.x+y)%(2*Math.PI)));this.pivot.rotation.copy(this.current_rotation)}},{key:"update_scale",value:function s(x){this.camera.setFocalLength(Math.max(this.min_focal_length,Math.min(this.max_focal_length,this.starting_focal_length+x)))}},{key:"on_resize",value:function v(){this.$container.height(this.$container.width()/this.aspect);this.renderer.setSize(this.$container.width(),this.$container.height());this.camera.aspect=this.$container.width()/this.$container.height();this.camera.updateProjectionMatrix();this.render()}},{key:"on_mouse_down",value:function o(y){this.drag_start.set(y.pageX,y.pageY);this.starting_rotation.copy(this.pivot.rotation);this.dragging=true;var x=this;document.addEventListener("mousemove",this.mouse_move_handler,false);document.addEventListener("mouseup",this.mouse_up_handler,false)}},{key:"on_mouse_move",value:function t(x){if(!this.dragging){return}x.preventDefault();var y=-(x.pageX-this.drag_start.x)/$(window).width()*2*Math.PI;var z=-(x.pageY-this.drag_start.y)/$(window).height()*2*Math.PI;this.update_rotation(z,y);this.render()}},{key:"on_mouse_up",value:function q(x){this.dragging=false;document.removeEventListener("mousemove",this.mouse_move_handler,false);document.removeEventListener("mouseup",this.mouse_up_handler,false)}},{key:"on_wheel",value:function n(x){var y=-x.originalEvent.deltaY;x.preventDefault();switch(x.originalEvent.deltaMode){case 0:y*=(this.max_focal_length-this.min_focal_length)/$(window).height();break;case 1:case 2:y*=(this.max_focal_length-this.min_focal_length)/this.zoom_steps;break}this.starting_focal_length=this.camera.getFocalLength();this.update_scale(y*this.zoom_sensitivity);this.render()}},{key:"on_touch_start",value:function p(z){var y=z.touches[0].pageX;var x=z.touches[0].pageY;if(z.touches.length==2){y=(z.touches[0].pageX+z.touches[1].pageX)/2;x=(z.touches[0].pageY+z.touches[1].pageY)/2}this.drag_start.set(y,x);this.starting_rotation.copy(this.pivot.rotation);this.dragging=true;switch(z.touches.length){case 1:break;case 2:z.preventDefault();this.scale_start_distance=new THREE.Vector2(z.touches[0].pageX,z.touches[0].pageY).distanceTo(new THREE.Vector2(z.touches[1].pageX,z.touches[1].pageY));this.starting_focal_length=this.camera.getFocalLength();this.two_fingers_touching=true;break}document.addEventListener("mousemove",this.mouse_move_handler,false);document.addEventListener("mouseup",this.mouse_up_handler,false)}},{key:"on_touch_move",value:function w(z){if(!this.dragging){return}var y=z.touches[0].pageX;var x=z.touches[0].pageY;if(this.two_fingers_touching&&z.touches.length==2){y=(z.touches[0].pageX+z.touches[1].pageX)/2;x=(z.touches[0].pageY+z.touches[1].pageY)/2}var A=-(y-this.drag_start.x)/$(window).width()*2*Math.PI;var D=-(x-this.drag_start.y)/$(window).height()*2*Math.PI;if(!this.two_fingers_touching||z.touches.length!=2){D=0}this.update_rotation(D,A);if(this.two_fingers_touching&&z.touches.length==2){z.preventDefault();var C=new THREE.Vector2(z.touches[0].pageX,z.touches[0].pageY).distanceTo(new THREE.Vector2(z.touches[1].pageX,z.touches[1].pageY));var B=(C-this.scale_start_distance)/$(window).width()*(this.max_focal_length-this.min_focal_length);this.update_scale(B)}this.render()}},{key:"on_touch_cancel",value:function m(x){this.on_touch_end(x)}},{key:"on_touch_end",value:function k(x){this.on_mouse_up(x);this.two_fingers_touching=false}}]);return r}()},{"../shaders/default-vertex.glsl":6}],4:[function(c,f,b){Object.defineProperty(b,"__esModule",{value:true});var d=function(){function h(m,k){for(var j=0;j<k.length;j++){var l=k[j];l.enumerable=l.enumerable||false;l.configurable=true;if("value" in l){l.writable=true}Object.defineProperty(m,l.key,l)}}return function(k,i,j){if(i){h(k.prototype,i)}if(j){h(k,j)}return k}}();function g(h,i){if(!(h instanceof i)){throw new TypeError("Cannot call a class as a function")}}var a=b.VisualizationControlSlider=function(){function h(o,l,n){g(this,h);this.$parent=parent;this.color_system_property=l;this.control_id=Math.floor(Math.random()*1000000000000000).toString();this.slider_id="vis-ctrl-"+this.control_id+"-slider";this.number_id="vis-ctrl-"+this.control_id+"-number";var k='min="'+this.color_system_property.min+'" max="'+this.color_system_property.max+'" step="'+n.toString()+'" value="'+this.color_system_property.value.toString()+'"';o.append('<div class="visualization-control slider"><label for="'+this.slider_id+'">'+this.color_system_property.name+':</label><input type="number" value="'+this.color_system_property.value.toString()+'" id="'+this.number_id+'" '+k+' /><span class="slider-container"><input type="range" name="'+this.slider_id+'" id="'+this.slider_id+'" '+k+" /></span></div>");var m=this;$("#"+this.slider_id).on("input",function(p){return m.on_slider_change(p)});$("#"+this.number_id).on("change",function(p){return m.on_number_change(p)})}d(h,[{key:"on_slider_change",value:function i(k){$("#"+this.number_id).val(k.target.value)}},{key:"on_number_change",value:function j(k){$("#"+this.slider_id).val(k.target.value)}}]);return h}()},{}],5:[function(c,d,b){var g=c("./RGBCubeVisualization");var a=[];var f={};$(document).ready(function(){console.log("Initializing visualizations.");$(".visualization.rgb-cube").each(function(){var h=new g.RGBCubeVisualization($(this));h.render();a.push(h)});$(".figure-title").each(function(h){var i=$(this).parent().attr("id");f[i]=h+1;$(this).prepend("<b>Figure "+(h+1).toString()+":</b> ")});$("figref").each(function(){var h=$(this).data("fig-id");$(this).html('<a href="#'+h+'">Figure '+f[h]+"</a>")})})},{"./RGBCubeVisualization":2}],6:[function(b,c,a){c.exports=function d(i){var g="/* \n * Predefined built-in uniforms and attributes for vertex shader: \n * http://threejs.org/docs/api/renderers/webgl/WebGLProgram.html \n \n * // = object.matrixWorld \n * uniform mat4 modelMatrix; \n \n * // = camera.matrixWorldInverse * object.matrixWorld \n * uniform mat4 modelViewMatrix; \n \n * // = camera.projectionMatrix \n * uniform mat4 projectionMatrix; \n \n * // = camera.matrixWorldInverse \n * uniform mat4 viewMatrix; \n \n * // = inverse transpose of modelViewMatrix \n * uniform mat3 normalMatrix; \n \n * // = camera position in world space \n * uniform vec3 cameraPosition; \n * \n * Additionally from GLSL: \n * https://www.opengl.org/wiki/Built-in_Variable_(GLSL) \n * gl_FragCoord \n */ \n \n/* \n  Fragment position in world space. \n  Thanks to \n  https://www.opengl.org/discussion_boards/showthread.php/163272-How-do-I-get-a-fragments-x-y-z-in-world-coordinates-in-the-fragment-shader \n  and \n  https://en.wikibooks.org/wiki/GLSL_Programming/Unity/Shading_in_World_Space \n*/ \nvarying vec4 worldCoord; \n \n/** \n * Multiply each vertex by the \n * model-view matrix and the \n * projection matrix (both provided \n * by Three.js) to get a final \n * vertex position. \n * (Copied from https://aerotwist.com/tutorials/an-introduction-to-shaders-part-1/) \n */ \nvoid main() { \n  worldCoord = modelMatrix * vec4(position,1.0); \n \n  gl_Position = projectionMatrix * \n                modelViewMatrix * \n                vec4(position,1.0); \n} \n";i=i||{};for(var f in i){var h=new RegExp("{{"+f+"}}","g");g=g.replace(h,i[f])}return g}},{}],7:[function(b,c,a){c.exports=function d(i){var g="varying vec4 worldCoord; \n \nvoid main() { \n    /* worldPos = ModelView^(-1) * Projection^(-1) * p */ \n    /*mat4 normalMatrix4 = mat4(varNormalMatrix); \n    normalMatrix4[3][3] = 1.0; \n    vec4 worldPositionTmp = normalMatrix4 * gl_FragCoord; \n    vec4 worldPosition = vec4( \n        worldPositionTmp.x, \n        worldPositionTmp.y, \n        worldPositionTmp.z, \n        worldPositionTmp.z / gl_FragCoord.w // undo perspective projection matrix \n    );*/ \n    gl_FragColor = vec4(worldCoord.x, \n                        worldCoord.y, \n                        worldCoord.z, \n                        1.0); \n} \n \n";i=i||{};for(var f in i){var h=new RegExp("{{"+f+"}}","g");g=g.replace(h,i[f])}return g}},{}]},{},[5]);